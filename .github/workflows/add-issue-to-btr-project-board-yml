name: Add release testing issues to BTR project and needs triage label
on:
  issues:
    types: [labeled]
jobs:
  add-issue-to-project:
    name: "Add release testing issue to project"
    if: github.event.label.name == 'release testing'
    uses: openedx/.github/.github/workflows/add-issue-to-a-project.yml@master
    secrets:
      GITHUB_APP_ID: ${{ secrets.GRAPHQL_AUTH_APP_ID }}
      GITHUB_APP_PRIVATE_KEY: ${{ secrets.GRAPHQL_AUTH_APP_PEM }}
    with:
      # required, it's the numeric part of a github project url
      # for example, https://github.com/orgs/openedx/projects/28 has PROJECT_NUMBER: 28
      PROJECT_NUMBER: 28

  add-needs-triage-label:
    name: "Add needs triage label"
    runs-on: ubuntu-latest
    if: github.event.label.name == 'release testing' && !contains(github.event.issue.labels.*.name, 'needs triage')
    steps:
      - name: Apply needs triage label
        uses: actions-ecosystem/action-add-labels@v1
        with:
          labels: needs triage
